<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
</head>
<body>
<h1>Admin Panel</h1>

<label>Admin Token:</label>
<input type="password" id="token" value="admin123" />
<button id="loginBtn">Кіру</button>

<div id="panel" style="display:none;">
  <h2>Users</h2>
  <table border="1" id="usersTable">
    <thead>
      <tr>
        <th>Telegram ID</th>
        <th>Баланс</th>
        <th>Жаңа баланс</th>
        <th>Сақтау</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const BASE_URL = "https://azionline.onrender.com"; // ✅ Render сервер URL

const loginBtn = document.getElementById("loginBtn");
const tokenInput = document.getElementById("token");
const panel = document.getElementById("panel");
const usersTableBody = document.querySelector("#usersTable tbody");

loginBtn.onclick = async () => {
  const token = tokenInput.value.trim();
  try {
    // API сұрау Render URL арқылы
    const res = await fetch(`${BASE_URL}/api/admin/users`, {
      headers: { Authorization: token }
    });

    if (!res.ok) throw new Error("Unauthorized or server error");

    const users = await res.json();
    panel.style.display = "block";
    usersTableBody.innerHTML = "";

    users.forEach(user => {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${user.telegramId}</td>
        <td>${user.balance}</td>
        <td><input type="number" value="${user.balance}" /></td>
        <td><button>Сақтау</button></td>
      `;

      const saveBtn = row.querySelector("button");
      const input = row.querySelector("input");

      saveBtn.onclick = async () => {
        const newBalance = Number(input.value);
        await fetch(`${BASE_URL}/api/admin/balance`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": token
          },
          body: JSON.stringify({ telegramId: user.telegramId, balance: newBalance })
        });
        alert("Баланс жаңартылды!");
      };

      usersTableBody.appendChild(row);
    });
  } catch (err) {
    alert("❌ Серверге қосыла алмады немесе қате: " + err.message);
  }
};
</script>
</body>
</html>
