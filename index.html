<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body { font-family: Arial; padding: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background: #f0f0f0; }
input[type=number]{ width: 80px; }
button { padding: 5px 10px; cursor: pointer; }
</style>
</head>
<body>
<h1>Admin Panel</h1>
<button id="loadUsersBtn">Load Users</button>
<table id="usersTable">
<thead>
<tr><th>Telegram ID</th><th>Balance</th><th>Add Balance</th><th>Action</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const API_BASE = "https://azionline.onrender.com/api"; // Render серверің

const loadUsersBtn = document.getElementById("loadUsersBtn");
const usersTableBody = document.querySelector("#usersTable tbody");

loadUsersBtn.addEventListener("click", async () => {
    const res = await fetch(API_BASE + "/users");
    const users = await res.json();

    usersTableBody.innerHTML = "";
    users.forEach(user => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${user.telegramId}</td>
            <td>${user.balance}</td>
            <td><input type="number" value="0" min="0" class="addBalanceInput"></td>
            <td><button class="updateBtn">Add</button></td>
        `;
        const addInput = row.querySelector(".addBalanceInput");
        const updateBtn = row.querySelector(".updateBtn");

        updateBtn.addEventListener("click", async () => {
            const amount = parseInt(addInput.value);
            if(isNaN(amount) || amount<=0) return alert("Enter a valid amount");

            const resp = await fetch(`${API_BASE}/users/${user.telegramId}/add`, {
                method: "POST",
                headers: {"Content-Type":"application/json"},
                body: JSON.stringify({amount})
            });

            if(resp.ok){
                alert("Balance updated!");
                loadUsersBtn.click();
            } else alert("Error updating balance");
        });

        usersTableBody.appendChild(row);
    });
});
</script>
</body>
</html>
