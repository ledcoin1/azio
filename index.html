<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Telegram Game</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f9; padding: 20px; }
  h1 { text-align: center; color: #333; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
  th { background: #eee; }
  input[type=number] { width: 60px; }
  button { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; background: #4CAF50; color: white; }
</style>
</head>
<body>

<h1>Admin Panel - Telegram Game</h1>
<table>
  <thead>
    <tr>
      <th>Telegram ID</th>
      <th>Баланс</th>
      <th>Қосу</th>
      <th>Операция</th>
    </tr>
  </thead>
  <tbody id="usersTable"></tbody>
</table>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
  const API_BASE = "https://azionline.onrender.com"; // Render серверің
  const socket = io(API_BASE);

  async function loadUsers() {
    try {
      const res = await fetch(`${API_BASE}/api/users`);
      const users = await res.json();
      const tbody = document.getElementById("usersTable");
      tbody.innerHTML = "";

      users.forEach(user => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${user.telegramId}</td>
          <td id="balance-${user.telegramId}">${user.balance}</td>
          <td><input type="number" id="input-${user.telegramId}" value="0"></td>
          <td><button onclick="updateBalance('${user.telegramId}')">Жаңарту</button></td>
        `;
        tbody.appendChild(tr);
      });
    } catch(err) {
      console.error(err);
      alert("Қолданушыларды жүктеу мүмкін болмады!");
    }
  }

  async function updateBalance(telegramId) {
    const input = document.getElementById(`input-${telegramId}`);
    const amount = parseInt(input.value);
    if (isNaN(amount)) return alert("Сан енгізіңіз!");

    try {
      const res = await fetch(`${API_BASE}/api/users/update`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ telegramId, amount })
      });
      const data = await res.json();
      document.getElementById(`balance-${telegramId}`).innerText = data.balance;
      input.value = 0;
    } catch(err) {
      console.error(err);
      alert("Баланс жаңартылмады!");
    }
  }

  loadUsers();
</script>

</body>
</html>
